---
title: "KAS_level"
author: "Gayoung Park"
date: "10/29/2018"
output: html_document
---

```{r setup, include=FALSE}
suppressMessages(library(tidyverse))
library(glue)

#data from PhD data sheet, not KAS sheet.
mydata  <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRBTqiIHQP1Pg3De1IGsJgVFiJla1dIHyHsGEsSmel8WVAeXXXHmSiyNnQAad9ATdzeukS43WE3PZ2m/pub?gid=0&single=true&output=csv")

#dafa from KAS data sheet.
kasr <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQQ9zhSCHjt-1qdSLltD1rhEI_DmaIKtah5yA9WWlsB0gGJWMOYltZR71r00NgkfaYz8YH392oZOWPu/pub?gid=1950751706&single=true&output=csv")

```

I just wanted to make a plot for elevation of each site, and show is there is a relationship between the time of first occupation and elevation, and whether or not there are stemmed points.

We can see that the sites without stemmed points are earlier, and at high elevations. But then after stemmed points appear, the sites without stemmed points are only found at low elevations, and the stem point sites are at higher elevations. So it might suggest that the stemmed point was an important artefact for adapting to high elevations, especially into the period of the Last Glacial Maximum. 

```{r}
mydata_ages <- 
  mydata %>% 
  separate(C14.BP., into = c('age', 'error'),
          sep = "Â±") %>% 
  mutate(age_ka = parse_number(age) / 1000,
         error = parse_number(error)) %>% 
  mutate(has_sp = ifelse(!is.na(SP.), "yes", "no"))

ggplot(mydata_ages, 
       aes(x = age_ka,
           y = altitude.m._of_main_layer,
       color = as.factor(has_sp))) +
  geom_point(size = 3) +
  xlab("Age of occupation (ka)") +
  ylab("Elevation above sea level (m)") +
  geom_smooth(se = FALSE) +
  scale_colour_discrete(name = "Contains\nstemmed\npoints?") +
  theme_minimal(base_size = 16) 
```


Using raw material information sheeet from KAS data sheets.

```{r}
kasr_long <- 
  kasr %>% 
  gather(site, 
         count, 
         -X) %>% 
  group_by(site) %>% 
  mutate(percentage = count / sum(count, na.rm = TRUE) * 100,
         total = sum(count, na.rm = TRUE)) %>% 
  filter(!is.na(percentage)) %>% 
  mutate(axis_label = glue('{site}\n(n = {total})'))


ggplot(kasr_long, 
       aes(axis_label, 
           percentage,
           fill = X)) +
  geom_col() +
  xlab("Site name") +
  ylab("Percentage") +
  scale_fill_discrete(name = "Raw material type") +
  theme_minimal(base_size = 16) 
```